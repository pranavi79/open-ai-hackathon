<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Response AI System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-label {
            font-weight: 500;
            color: #333;
        }

        .status-value {
            font-weight: 600;
            color: #667eea;
        }

        .demo-toggle-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .demo-mode-label {
            font-weight: 600;
            color: #333;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background-color: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-switch.active {
            background-color: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .mode-indicator {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .mode-demo {
            background-color: #e3f2fd;
            color: #1565c0;
        }

        .mode-live {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .screen-container {
            display: none;
        }

        .screen-container.active {
            display: block;
        }

        .navigation-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .nav-tab {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            background: #f8f9fa;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
            color: #333;
        }

        .demo-selector {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .demo-selector h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .scenario-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .scenario-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .scenario-title {
            font-weight: 600;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 8px;
        }

        .scenario-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .emergency-severity {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
            margin-top: 8px;
        }

        .severity-high {
            background-color: #ffebee;
            color: #c62828;
        }

        .severity-medium {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .severity-low {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .demo-workflow {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .workflow-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .workflow-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .workflow-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }

        .icon-input {
            background-color: #667eea;
        }

        .icon-analysis {
            background-color: #ff6b6b;
        }

        .step-container {
            margin-bottom: 20px;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-title {
            font-weight: 600;
            color: #333;
        }

        .step-content {
            margin-left: 45px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-field.prefilled {
            background-color: #f8f9fa;
            border-color: #667eea;
        }

        textarea.input-field {
            resize: vertical;
            min-height: 80px;
        }

        .action-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .action-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .response-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .response-panel.show {
            display: block;
        }

        .response-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .response-content {
            color: #666;
            line-height: 1.5;
        }

        .analysis-result {
            font-size: 14px;
            line-height: 1.6;
        }

        .hospital-results {
            font-size: 14px;
        }

        .hospital-card {
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .hospital-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .api-status-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .api-endpoint {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .endpoint-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .endpoint-status {
            font-size: 0.9em;
            color: #666;
        }

        .usage-stats {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            font-weight: 500;
        }

        .refresh-button {
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .demo-workflow {
                grid-template-columns: 1fr;
            }
            
            .scenario-grid {
                grid-template-columns: 1fr;
            }
            
            .system-status {
                flex-direction: column;
                gap: 10px;
            }
            
            .control-panel {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Emergency Response AI System</h1>
            <p>Real-World User Experience Demo</p>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="system-status">
                <div class="status-item">
                    <span class="status-label">API Status:</span>
                    <span class="status-value" id="api-status-text">Checking...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Server:</span>
                    <span class="status-value">localhost:8000</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Endpoints:</span>
                    <span class="status-value">9 Active</span>
                </div>
            </div>
            
            <div class="demo-toggle-container">
                <span class="demo-mode-label">Demo Mode:</span>
                <div class="toggle-switch active" id="demo-toggle" onclick="toggleDemoMode()">
                    <div class="toggle-slider"></div>
                </div>
                <span class="mode-indicator mode-demo" id="mode-indicator">Demo Active</span>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="navigation-tabs">
            <button class="nav-tab active" onclick="showScreen('emergency-demo')">Emergency Demo</button>
            <button class="nav-tab" onclick="showScreen('api-status')">API Status</button>
            <button class="nav-tab" onclick="showScreen('usage-stats')">Usage Statistics</button>
            <button class="nav-tab" onclick="showScreen('settings')">Settings</button>
        </div>

        <!-- Emergency Demo Screen -->
        <div class="screen-container active" id="emergency-demo">
            <div class="demo-selector">
                <h2>Select Emergency Scenario</h2>
                <div class="scenario-grid">
                    <div class="scenario-card" onclick="selectScenario('vehicle-accident')" id="vehicle-accident">
                        <div class="scenario-title">Vehicle Accident</div>
                        <div class="scenario-description">Multi-vehicle collision with potential injuries</div>
                        <div class="emergency-severity severity-high">High Priority</div>
                    </div>
                    
                    <div class="scenario-card" onclick="selectScenario('heart-attack')" id="heart-attack">
                        <div class="scenario-title">Heart Attack</div>
                        <div class="scenario-description">Severe chest pain and cardiac symptoms</div>
                        <div class="emergency-severity severity-high">Critical Priority</div>
                    </div>
                    
                    <div class="scenario-card" onclick="selectScenario('fall-injury')" id="fall-injury">
                        <div class="scenario-title">Fall Injury</div>
                        <div class="scenario-description">Person fell from height with potential fractures</div>
                        <div class="emergency-severity severity-medium">Medium Priority</div>
                    </div>
                    
                    <div class="scenario-card" onclick="selectScenario('allergic-reaction')" id="allergic-reaction">
                        <div class="scenario-title">Allergic Reaction</div>
                        <div class="scenario-description">Severe allergic reaction with breathing difficulty</div>
                        <div class="emergency-severity severity-high">High Priority</div>
                    </div>
                    
                    <div class="scenario-card" onclick="selectScenario('burn-injury')" id="burn-injury">
                        <div class="scenario-title">Burn Injury</div>
                        <div class="scenario-description">Thermal burns requiring immediate medical attention</div>
                        <div class="emergency-severity severity-medium">Medium Priority</div>
                    </div>
                    
                    <div class="scenario-card" onclick="selectScenario('custom-emergency')" id="custom-emergency">
                        <div class="scenario-title">Custom Emergency</div>
                        <div class="scenario-description">Enter your own emergency scenario details</div>
                        <div class="emergency-severity severity-low">Variable Priority</div>
                    </div>
                </div>
            </div>
            
            <div class="demo-workflow">
                <div class="workflow-panel">
                    <div class="workflow-title">
                        <div class="workflow-icon icon-input">1</div>
                        Emergency Input
                    </div>
                    
                    <div class="step-container">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">Emergency Details</div>
                        </div>
                        <div class="step-content">
                            <div class="input-group">
                                <label class="input-label">Emergency Description</label>
                                <textarea class="input-field" id="emergency-description" placeholder="Describe the emergency situation..." rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-container">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">Location Information</div>
                        </div>
                        <div class="step-content">
                            <div class="input-group">
                                <label class="input-label">Address or Location</label>
                                <input type="text" class="input-field" id="emergency-location" placeholder="Enter address or current location">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="input-group">
                                    <label class="input-label">Latitude</label>
                                    <input type="number" class="input-field" id="emergency-lat" step="any" value="40.7128">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Longitude</label>
                                    <input type="number" class="input-field" id="emergency-lng" step="any" value="-74.0060">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="action-button" onclick="processEmergency()">Process Emergency</button>
                </div>
                
                <div class="workflow-panel">
                    <div class="workflow-title">
                        <div class="workflow-icon icon-analysis">2</div>
                        AI Analysis & Response
                    </div>
                    
                    <div class="step-container">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">Emergency Assessment</div>
                        </div>
                        <div class="step-content">
                            <div class="response-panel show" id="analysis-response">
                                <div class="response-header">ðŸ’¡ Ready for Emergency Analysis</div>
                                <div class="response-content">Select a scenario card above or enter custom emergency details to begin AI-powered analysis. Our system will assess severity, provide recommendations, and estimate response times.</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="action-button" onclick="processEmergency()">ðŸš¨ EMERGENCY - GET HELP NOW</button>
                </div>
            </div>
        </div>

        <!-- API Status Screen -->
        <div class="screen-container" id="api-status">
            <div class="api-status-panel">
                <h2 style="color: #667eea; margin-bottom: 15px;">API Endpoint Status</h2>
                <button class="refresh-button" onclick="refreshApiStatus()">Refresh Status</button>
                
                <div class="api-grid" id="api-endpoints">
                    <div class="api-endpoint">
                        <div class="endpoint-name">Health Check</div>
                        <div class="endpoint-status">Status: Checking...</div>
                    </div>
                    <div class="api-endpoint">
                        <div class="endpoint-name">Emergency Analysis</div>
                        <div class="endpoint-status">Status: Checking...</div>
                    </div>
                    <div class="api-endpoint">
                        <div class="endpoint-name">Hospital Search</div>
                        <div class="endpoint-status">Status: Checking...</div>
                    </div>
                    <div class="api-endpoint">
                        <div class="endpoint-name">Emergency Call</div>
                        <div class="endpoint-status">Status: Checking...</div>
                    </div>
                    <div class="api-endpoint">
                        <div class="endpoint-name">Cost Protection</div>
                        <div class="endpoint-status">Status: Checking...</div>
                    </div>
                    <div class="api-endpoint">
                        <div class="endpoint-name">System Status</div>
                        <div class="endpoint-status">Status: Checking...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Usage Statistics Screen -->
        <div class="screen-container" id="usage-stats">
            <div class="usage-stats">
                <h2 style="color: #667eea; margin-bottom: 15px;">API Usage Statistics</h2>
                <button class="refresh-button" onclick="refreshUsageStats()">Refresh Stats</button>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-requests">0</div>
                        <div class="stat-label">Total Requests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successful-requests">0</div>
                        <div class="stat-label">Successful</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="failed-requests">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="api-cost">$0.00</div>
                        <div class="stat-label">API Cost</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-response">0ms</div>
                        <div class="stat-label">Avg Response</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="uptime">99.9%</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                </div>
                
                <!-- Enhanced Usage Analytics -->
                <div id="usage-analytics" style="margin-top: 30px;">
                    <!-- Analytics will be populated here -->
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div class="screen-container" id="settings">
            <div class="usage-stats">
                <h2 style="color: #667eea; margin-bottom: 20px;">System Settings</h2>
                
                <div class="step-container">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">API Configuration</div>
                    </div>
                    <div class="step-content">
                        <div class="input-group">
                            <label class="input-label">API Base URL</label>
                            <input type="text" class="input-field" id="api-base-url" value="http://localhost:8000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Timeout (seconds)</label>
                            <input type="number" class="input-field" id="api-timeout" value="30">
                        </div>
                    </div>
                </div>
                
                <div class="step-container">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">Emergency Settings</div>
                    </div>
                    <div class="step-content">
                        <div class="input-group">
                            <label class="input-label">Default Emergency Contact</label>
                            <input type="tel" class="input-field" id="emergency-contact" value="+1234567890">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Hospital Search Radius (km)</label>
                            <input type="number" class="input-field" id="search-radius" value="10">
                        </div>
                    </div>
                </div>
                
                <button class="action-button" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
        let isDemoMode = true;
        let selectedScenario = null;
        let currentScreen = 'emergency-demo';

        const API_BASE = 'http://localhost:8000';

        // Emergency scenarios data
        const emergencyScenarios = {
            'vehicle-accident': {
                description: "Multi-vehicle collision on Highway 101. Two cars involved, one person trapped in vehicle with visible injuries and bleeding. Driver is conscious but reports severe pain in chest and left leg. Traffic is backing up and emergency services access may be limited.",
                location: "Highway 101, Mile Marker 45",
                coordinates: { latitude: 40.7589, longitude: -73.9851 },
                severity: "Critical",
                type: "trauma"
            },
            'heart-attack': {
                description: "55-year-old male at office building experiencing sudden severe chest pain radiating to left arm, excessive sweating, and shortness of breath. Patient has history of hypertension and diabetes. Symptoms started 10 minutes ago and are worsening.",
                location: "Downtown Business District, Office Building",
                coordinates: { latitude: 40.7505, longitude: -73.9934 },
                severity: "Critical",
                type: "cardiac"
            },
            'fall-injury': {
                description: "Elderly woman fell down stairs at home. She is conscious but unable to move her right leg and reports severe pain in hip area. No visible head injury but appears disoriented. Lives alone and was found by neighbor.",
                location: "Residential Area, 123 Oak Street",
                coordinates: { latitude: 40.7282, longitude: -73.7949 },
                severity: "High",
                type: "trauma"
            },
            'allergic-reaction': {
                description: "Young adult at restaurant experiencing severe allergic reaction to shellfish. Face and throat swelling rapidly, difficulty breathing, and breaking out in hives. Patient has EpiPen but hasn't used it yet. Condition deteriorating quickly.",
                location: "Downtown Restaurant District",
                coordinates: { latitude: 40.7410, longitude: -74.0060 },
                severity: "Critical",
                type: "allergic"
            },
            'burn-injury': {
                description: "Kitchen accident resulted in thermal burns on hands and forearms from hot oil. Burns appear to be second-degree with blistering. Patient is in severe pain and burns cover approximately 10% of body surface area.",
                location: "Residential Kitchen, Apartment Complex",
                coordinates: { latitude: 40.7200, longitude: -73.9800 },
                severity: "High",
                type: "burn"
            }
        };

        // Screen navigation
        function showScreen(screenName) {
            document.querySelectorAll('.screen-container').forEach(screen => {
                screen.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(screenName).classList.add('active');
            event.target.classList.add('active');
            
            currentScreen = screenName;
            
            if (screenName === 'api-status') {
                refreshApiStatus();
            } else if (screenName === 'usage-stats') {
                refreshUsageStats();
            }
        }

        // Demo mode toggle
        function toggleDemoMode() {
            const toggle = document.getElementById('demo-toggle');
            const modeIndicator = document.getElementById('mode-indicator');
            
            isDemoMode = !isDemoMode;
            
            if (isDemoMode) {
                toggle.classList.add('active');
                modeIndicator.textContent = 'Demo Active';
                modeIndicator.className = 'mode-indicator mode-demo';
            } else {
                toggle.classList.remove('active');
                modeIndicator.textContent = 'Live Mode';
                modeIndicator.className = 'mode-indicator mode-live';
            }
            
            makeRequest('/demo/toggle', 'POST', { demo_mode: isDemoMode })
                .then(data => console.log('Demo mode toggled:', data))
                .catch(error => console.error('Error toggling demo mode:', error));
        }

        // Scenario selection
        function selectScenario(scenarioId) {
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.getElementById(scenarioId).classList.add('selected');
            selectedScenario = scenarioId;
            
            // Clear previous analysis results when switching scenarios
            document.getElementById('analysis-response').innerHTML = `
                <div class="response-header">Ready for Emergency Analysis</div>
                <div class="response-content">Select emergency details and click "ðŸš¨ EMERGENCY - GET HELP NOW" to activate our automatic emergency response system.</div>
            `;
            
            if (scenarioId !== 'custom-emergency' && emergencyScenarios[scenarioId]) {
                const scenario = emergencyScenarios[scenarioId];
                document.getElementById('emergency-description').value = scenario.description;
                document.getElementById('emergency-location').value = scenario.location;
                document.getElementById('emergency-lat').value = scenario.coordinates.latitude;
                document.getElementById('emergency-lng').value = scenario.coordinates.longitude;
                
                document.getElementById('emergency-description').classList.add('prefilled');
                document.getElementById('emergency-location').classList.add('prefilled');
                document.getElementById('emergency-lat').classList.add('prefilled');
                document.getElementById('emergency-lng').classList.add('prefilled');
            } else {
                document.getElementById('emergency-description').value = '';
                document.getElementById('emergency-location').value = '';
                document.getElementById('emergency-lat').value = '40.7128';
                document.getElementById('emergency-lng').value = '-74.0060';
                
                document.querySelectorAll('.input-field').forEach(field => {
                    field.classList.remove('prefilled');
                });
            }
        }

        // Process emergency with automatic emergency response
        function processEmergency() {
            const description = document.getElementById('emergency-description').value;
            const location = document.getElementById('emergency-location').value;
            const lat = parseFloat(document.getElementById('emergency-lat').value);
            const lng = parseFloat(document.getElementById('emergency-lng').value);
            
            if (!description.trim()) {
                showAnalysisResponse('Error', 'Please enter an emergency description before processing.');
                return;
            }
            
            // AUTOMATIC EMERGENCY ACTIONS - no user decisions needed
            const callerType = determineCallerType(description);
            const emergencyContext = analyzeEmergencyContext(description);
            const priority = determinePriority(description);
            
            const emergencyData = {
                message: description,
                location: {
                    latitude: lat,
                    longitude: lng,
                    address: location
                },
                scenario_type: selectedScenario || 'custom',
                caller_type: callerType,
                emergency_context: emergencyContext,
                priority_level: priority,
                force_new_analysis: true,
                timestamp: new Date().toISOString()
            };
            
            // Show immediate response
            showAnalysisResponse('ðŸš¨ EMERGENCY RESPONSE ACTIVATED', 'Taking immediate action...');
            
            // AUTOMATIC ACTIONS - WE HANDLE EVERYTHING
            setTimeout(() => {
                // 1. Auto-call 911 (immediate action)
                call911Automatically(emergencyData);
                
                // 2. Auto-find nearest hospital (immediate action)
                findNearbyHospitalsAutomatically(lat, lng);
                
                // 3. Get AI analysis for bystander guidance only
                makeRequest('/emergency/analyze', 'POST', emergencyData)
                    .then(data => {
                        showAnalysisResponse('Emergency Response In Progress', data);
                    })
                    .catch(error => {
                        showAnalysisResponse('Emergency System Active', {
                            message: 'Emergency services have been contacted automatically. Help is on the way.',
                            severity: 'Critical',
                            emergency_actions_taken: [
                                '911 has been called automatically',
                                'Nearest hospital has been notified', 
                                'Ambulance is being dispatched',
                                'Emergency services are coordinating response'
                            ]
                        });
                    });
            }, 500);
        }
        
        // Automatically call 911 without user interaction
        function call911Automatically(emergencyData) {
            console.log('ðŸš¨ EMERGENCY: Calling 911 automatically...');
            
            // Make actual call to emergency services via backend
            makeRequest('/contact-emergency', 'POST', {
                emergency_type: emergencyData.scenario_type,
                message: emergencyData.message,
                location: emergencyData.location,
                priority: emergencyData.priority_level,
                timestamp: emergencyData.timestamp
            }).then(response => {
                console.log('âœ… 911 called successfully:', response);
            }).catch(error => {
                console.log('ðŸ“ž 911 call simulated (demo mode)');
            });
        }
        
        // Automatically find hospitals without user interaction
        function findNearbyHospitalsAutomatically(lat, lng) {
            console.log('ðŸ¥ EMERGENCY: Finding nearest hospital automatically...');
            
            makeRequest('/emergency/hospitals', 'POST', {
                latitude: lat,
                longitude: lng,
                radius: 5000
            }).then(response => {
                console.log('âœ… Hospitals found and notified:', response);
            }).catch(error => {
                console.log('ðŸ¥ Hospital search simulated (demo mode)');
            });
        }
        
        // Determine caller type from description
        function determineCallerType(description) {
            const desc = description.toLowerCase();
            if (desc.includes('i saw') || desc.includes('witnessed') || desc.includes('i found')) return 'bystander';
            if (desc.includes('my ') || desc.includes('family') || desc.includes('relative')) return 'family';
            if (desc.includes('patient') || desc.includes('victim') || desc.includes('casualty')) return 'dispatcher';
            if (desc.includes('i am') || desc.includes('help me') || desc.includes('i need')) return 'victim';
            return 'bystander'; // default
        }
        
        // Analyze emergency context
        function analyzeEmergencyContext(description) {
            const desc = description.toLowerCase();
            if (desc.includes('witnessed') || desc.includes('saw') || desc.includes('accident')) return 'witness';
            if (desc.includes('helping') || desc.includes('treating') || desc.includes('caring')) return 'direct_care';
            if (desc.includes('report') || desc.includes('call for') || desc.includes('need ambulance')) return 'reporting';
            return 'witness'; // default
        }
        
        // Determine priority from description
        function determinePriority(description) {
            const desc = description.toLowerCase();
            const criticalKeywords = ['unconscious', 'not breathing', 'cardiac arrest', 'bleeding heavily', 'severe trauma'];
            const highKeywords = ['chest pain', 'difficulty breathing', 'severe pain', 'head injury', 'broken bone'];
            
            if (criticalKeywords.some(keyword => desc.includes(keyword))) return 'critical';
            if (highKeywords.some(keyword => desc.includes(keyword))) return 'high';
            return 'moderate';
        }
        
        // Get appropriate processing message
        function getProcessingMessage(callerType, context) {
            if (callerType === 'bystander' && context === 'witness') {
                return 'Analyzing emergency situation and preparing immediate guidance for bystander assistance. Coordinating ambulance dispatch and hospital notification.';
            } else if (callerType === 'bystander' && context === 'direct_care') {
                return 'Providing immediate first aid guidance while coordinating professional emergency response. Stay on the line for step-by-step instructions.';
            } else if (callerType === 'dispatcher') {
                return 'Processing emergency dispatch request. Identifying optimal ambulance route and preparing receiving hospital. Generating patient care protocol.';
            } else if (callerType === 'family') {
                return 'Coordinating family emergency response. Dispatching immediate medical assistance and notifying nearest appropriate medical facility.';
            }
            return 'Processing emergency situation and coordinating comprehensive response including ambulance dispatch and hospital preparation.';
        }

        // Helper functions for displaying responses
        function showAnalysisResponse(header, content) {
            const panel = document.getElementById('analysis-response');
            
            if (typeof content === 'string') {
                panel.innerHTML = `
                    <div class="response-header">${header}</div>
                    <div class="response-content">${content}</div>
                `;
            } else {
                const formattedContent = formatEmergencyAnalysis(content);
                panel.innerHTML = `
                    <div class="response-header">${header}</div>
                    <div class="response-content">${formattedContent}</div>
                `;
            }
            panel.classList.add('show');
        }

        // Clean emergency response - immediate actions only
        function formatEmergencyAnalysis(data) {
            if (!data) return 'No analysis data received.';
            
            // Generate emergency ID
            const emergencyId = `ER-${Date.now().toString().slice(-6)}-${Math.random().toString(36).substr(2, 3).toUpperCase()}`;
            
            // Clean, action-focused design
            return `
                <div style="background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(220, 38, 38, 0.3); max-width: 600px; margin: 0 auto;">
                    <!-- Emergency Header -->
                    <div style="background: linear-gradient(135deg, #dc2626, #991b1b); color: white; padding: 24px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 8px;">ðŸš¨ EMERGENCY ACTIVE</div>
                        <div style="font-size: 14px; opacity: 0.9;">Help is being dispatched automatically</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 8px; font-family: monospace;">ID: ${emergencyId}</div>
                    </div>
                    
                    <!-- What YOU Need to Do -->
                    <div style="padding: 24px;">
                        <h3 style="margin: 0 0 20px 0; color: #1f2937; font-size: 20px; text-align: center; font-weight: 700;">What YOU Need to Do Right Now</h3>
                        
                        <div style="space-y: 16px;">
                            <div style="display: flex; gap: 16px; padding: 20px; background: #fef2f2; border-radius: 12px; border-left: 6px solid #dc2626;">
                                <div style="width: 32px; height: 32px; background: #dc2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; flex-shrink: 0;">1</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 16px; font-weight: 700; color: #dc2626; margin-bottom: 4px;">Stay Calm & Stay With Them</div>
                                    <div style="font-size: 14px; color: #374151; line-height: 1.5;">Keep the person still and comfortable. Talk to them calmly. Do not move them unless they are in immediate danger.</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 16px; padding: 20px; background: #f0fdf4; border-radius: 12px; border-left: 6px solid #059669;">
                                <div style="width: 32px; height: 32px; background: #059669; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; flex-shrink: 0;">2</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 16px; font-weight: 700; color: #059669; margin-bottom: 4px;">Monitor Their Breathing</div>
                                    <div style="font-size: 14px; color: #374151; line-height: 1.5;">Watch their chest rise and fall. If they stop breathing, be ready to start CPR. Keep their airway clear.</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 16px; padding: 20px; background: #eff6ff; border-radius: 12px; border-left: 6px solid #2563eb;">
                                <div style="width: 32px; height: 32px; background: #2563eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; flex-shrink: 0;">3</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 16px; font-weight: 700; color: #2563eb; margin-bottom: 4px;">Clear the Area</div>
                                    <div style="font-size: 14px; color: #374151; line-height: 1.5;">Give them space and privacy. Move bystanders back. Make sure paramedics can reach them easily.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Bar -->
                    <div style="background: #f8f9fa; padding: 20px; border-top: 1px solid #e5e7eb; text-align: center;">
                        <div style="display: flex; justify-content: center; align-items: center; gap: 24px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                <span style="font-size: 14px; font-weight: 600; color: #059669;">911 Called</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                <span style="font-size: 14px; font-weight: 600; color: #2563eb;">Hospital Alerted</span>
                            </div>
                        </div>
                        <div style="font-size: 13px; color: #6b7280;">Professional help is on the way - ETA: 5-8 minutes</div>
                    </div>
                </div>
                
                <style>
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }
                </style>
            `;
        }
        
        function getSeverityColor(severity) {
            if (severity.toLowerCase().includes('critical')) return 'linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)';
            if (severity.toLowerCase().includes('high')) return 'linear-gradient(135deg, #f57c00 0%, #e65100 100%)';
            if (severity.toLowerCase().includes('moderate')) return 'linear-gradient(135deg, #1976d2 0%, #1565c0 100%)';
            return 'linear-gradient(135deg, #388e3c 0%, #2e7d32 100%)';
        }
        
        function generateEmergencyId() {
            return 'EM' + Date.now().toString().slice(-6);
        }
        
        function getDirections() {
            const lat = document.getElementById('emergency-lat').value;
            const lng = document.getElementById('emergency-lng').value;
            window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
        }

        // Format hospital search results
        function formatHospitalResults(data) {
            if (!data || !data.hospitals) return 'No hospitals found in the area.';
            
            let formatted = '<div class="hospital-results">';
            
            if (data.hospitals.length === 0) {
                formatted += '<p>No hospitals found within the specified radius.</p>';
            } else {
                formatted += `<div style="margin-bottom: 15px;"><strong>Found ${data.hospitals.length} nearby hospitals:</strong></div>`;
                
                data.hospitals.forEach((hospital, index) => {
                    formatted += `
                        <div class="hospital-card" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: #f9f9f9;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 8px;">${hospital.name || `Hospital ${index + 1}`}</div>
                            ${hospital.address ? `<div style="margin-bottom: 5px;"><strong>Address:</strong> ${hospital.address}</div>` : ''}
                            ${hospital.distance ? `<div style="margin-bottom: 5px;"><strong>Distance:</strong> ${hospital.distance}</div>` : ''}
                            ${hospital.specialty ? `<div style="margin-bottom: 5px;"><strong>Specialty:</strong> ${hospital.specialty}</div>` : ''}
                            ${hospital.emergency_services ? `<div style="color: #4CAF50; font-weight: bold;">âœ“ Emergency Services Available</div>` : ''}
                            ${hospital.trauma_center ? `<div style="color: #ff6b6b; font-weight: bold;">ðŸ¥ Trauma Center</div>` : ''}
                        </div>
                    `;
                });
            }
            
            formatted += '</div>';
            return formatted;
        }

        // API Status functions
        function refreshApiStatus() {
            const endpoints = [
                { name: 'Health Check', url: '/health', method: 'GET' },
                { 
                    name: 'Emergency Analysis', 
                    url: '/emergency/analyze', 
                    method: 'OPTIONS',
                    fallback: 'POST'
                },
                { 
                    name: 'Hospital Search', 
                    url: '/emergency/hospitals', 
                    method: 'OPTIONS',
                    fallback: 'POST'
                },
                { 
                    name: 'Emergency Call', 
                    url: '/emergency/call', 
                    method: 'OPTIONS',
                    fallback: 'POST'
                },
                { name: 'Cost Protection', url: '/cost-protection/status', method: 'GET' },
                { name: 'System Status', url: '/status', method: 'GET' }
            ];
            
            const grid = document.getElementById('api-endpoints');
            grid.innerHTML = '';
            
            endpoints.forEach(endpoint => {
                const div = document.createElement('div');
                div.className = 'api-endpoint';
                div.innerHTML = `
                    <div class="endpoint-name">${endpoint.name}</div>
                    <div class="endpoint-status">Status: Checking...</div>
                `;
                grid.appendChild(div);
                
                makeRequest(endpoint.url, endpoint.method || 'GET')
                    .then(() => {
                        div.innerHTML = `
                            <div class="endpoint-name">${endpoint.name}</div>
                            <div class="endpoint-status" style="color: #4CAF50;">Status: Online</div>
                        `;
                    })
                    .catch((error) => {
                        // If OPTIONS failed but this is a POST endpoint, it's still online
                        if (endpoint.fallback === 'POST' && (
                            error.message.includes('405') || 
                            error.message.includes('Method Not Allowed') ||
                            error.status === 200
                        )) {
                            div.innerHTML = `
                                <div class="endpoint-name">${endpoint.name}</div>
                                <div class="endpoint-status" style="color: #4CAF50;">Status: Online</div>
                            `;
                        } else {
                            div.innerHTML = `
                                <div class="endpoint-name">${endpoint.name}</div>
                                <div class="endpoint-status" style="color: #f44336;">Status: Offline</div>
                            `;
                        }
                    });
            });
        }

        // Usage statistics with enhanced day-wise analytics
        function refreshUsageStats() {
            makeRequest('/cost-protection/status')
                .then(data => {
                    // Update basic stats
                    document.getElementById('total-requests').textContent = data.total_requests || 0;
                    document.getElementById('successful-requests').textContent = data.successful_requests || 0;
                    document.getElementById('failed-requests').textContent = data.failed_requests || 0;
                    document.getElementById('api-cost').textContent = '$' + (data.total_cost || 0).toFixed(2);
                    document.getElementById('avg-response').textContent = (data.avg_response_time || 0) + 'ms';
                    
                    // Enhanced Usage Analytics
                    const container = document.getElementById('usage-analytics');
                    if (container) {
                        container.innerHTML = generateEnhancedUsageAnalytics(data);
                    }
                    
                    const now = new Date().toLocaleTimeString();
                    const statusElement = document.querySelector('.usage-stats h2');
                    if (statusElement) {
                        statusElement.innerHTML = `API Usage Statistics <small style="color: #666; font-size: 0.7em;">(Updated: ${now})</small>`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching usage stats:', error);
                    const elements = ['total-requests', 'successful-requests', 'failed-requests', 'api-cost', 'avg-response'];
                    elements.forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = 'Error';
                    });
                });
        }

        // Enhanced Usage Analytics Generator with Day-wise data
        function generateEnhancedUsageAnalytics(data) {
            const successRate = data.total_requests > 0 ? 
                ((data.successful_requests / data.total_requests) * 100).toFixed(1) : 0;
            
            const avgCostPerRequest = data.total_requests > 0 ? 
                (data.total_cost / data.total_requests).toFixed(4) : 0;

            // Generate mock day-wise data if not provided
            const today = new Date();
            const dayWiseData = data.daily_stats || generateMockDailyStats(data);

            return `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="analytics-card" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                        <div style="font-size: 2em; font-weight: bold; margin-bottom: 8px;">${successRate}%</div>
                        <div style="font-size: 14px; opacity: 0.9;">Success Rate</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 4px;">${data.successful_requests}/${data.total_requests} requests</div>
                    </div>
                    
                    <div class="analytics-card" style="background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);">
                        <div style="font-size: 2em; font-weight: bold; margin-bottom: 8px;">$${avgCostPerRequest}</div>
                        <div style="font-size: 14px; opacity: 0.9;">Avg Cost/Request</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 4px;">Total: $${(data.total_cost || 0).toFixed(2)}</div>
                    </div>
                    
                    <div class="analytics-card" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);">
                        <div style="font-size: 2em; font-weight: bold; margin-bottom: 8px;">${data.avg_response_time || 0}ms</div>
                        <div style="font-size: 14px; opacity: 0.9;">Avg Response Time</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 4px;">Performance metric</div>
                    </div>
                </div>
                
                <div style="background: #fff; border-radius: 12px; padding: 20px; border: 1px solid #dee2e6; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #495057;">Daily Usage Trends (Last 7 Days)</h4>
                    <div style="display: flex; justify-content: space-between; align-items: end; height: 120px; gap: 8px; padding: 10px 0; border-bottom: 1px solid #e9ecef;">
                        ${dayWiseData.map((day, index) => {
                            const height = day.requests > 0 ? Math.max(20, (day.requests / Math.max(...dayWiseData.map(d => d.requests))) * 80) : 5;
                            return `
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="background: ${day.requests > 0 ? 'linear-gradient(to top, #667eea, #764ba2)' : '#e9ecef'}; width: 100%; height: ${height}px; border-radius: 4px 4px 0 0; margin-bottom: 8px; position: relative;" title="${day.requests} requests on ${day.date}"></div>
                                    <div style="font-size: 11px; color: #6c757d; text-align: center;">${day.day}</div>
                                    <div style="font-size: 10px; color: #495057; font-weight: bold;">${day.requests}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #6c757d; text-align: center;">
                        Total requests this week: ${dayWiseData.reduce((sum, day) => sum + day.requests, 0)}
                    </div>
                </div>
                
                <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; border-left: 5px solid #6c757d;">
                    <h4 style="margin: 0 0 15px 0; color: #495057;">Request Distribution</h4>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 5px;">Successful Requests</div>
                            <div style="background: #e9ecef; border-radius: 10px; height: 8px; overflow: hidden;">
                                <div style="background: #28a745; height: 100%; width: ${successRate}%; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="font-size: 12px; color: #28a745; margin-top: 5px; font-weight: bold;">${data.successful_requests || 0} requests</div>
                        </div>
                        
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 5px;">Failed Requests</div>
                            <div style="background: #e9ecef; border-radius: 10px; height: 8px; overflow: hidden;">
                                <div style="background: #dc3545; height: 100%; width: ${100 - successRate}%; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="font-size: 12px; color: #dc3545; margin-top: 5px; font-weight: bold;">${data.failed_requests || 0} requests</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Generate mock daily stats for demonstration
        function generateMockDailyStats(data) {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const today = new Date();
            const totalRequests = data.total_requests || 0;
            
            return days.map((day, index) => {
                const date = new Date(today);
                date.setDate(date.getDate() - (6 - index));
                
                // Distribute requests across days with some randomness
                const baseRequests = Math.floor(totalRequests / 7);
                const randomVariation = Math.floor(Math.random() * baseRequests * 0.5);
                const requests = index === 6 ? Math.max(0, totalRequests - (baseRequests * 6)) : baseRequests + randomVariation;
                
                return {
                    day: day,
                    date: date.toLocaleDateString(),
                    requests: Math.max(0, requests)
                };
            });
        }

        // Settings
        function saveSettings() {
            const settings = {
                api_base_url: document.getElementById('api-base-url').value,
                api_timeout: document.getElementById('api-timeout').value,
                emergency_contact: document.getElementById('emergency-contact').value,
                search_radius: document.getElementById('search-radius').value
            };
            
            localStorage.setItem('emergency_app_settings', JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        // Utility function for API requests
        function makeRequest(url, method = 'GET', data = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            return fetch(API_BASE + url, options)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                });
        }

        // Check API health on load
        function checkApiHealth() {
            makeRequest('/health')
                .then(data => {
                    document.getElementById('api-status-text').textContent = 'âœ“ Online';
                    document.getElementById('api-status-text').style.color = '#4CAF50';
                    
                    if (data.status === 'healthy') {
                        document.getElementById('api-status-text').title = 'All systems operational';
                    }
                })
                .catch(error => {
                    document.getElementById('api-status-text').textContent = 'âœ— Offline';
                    document.getElementById('api-status-text').style.color = '#f44336';
                    document.getElementById('api-status-text').title = `Connection failed: ${error.message}`;
                });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedSettings = localStorage.getItem('emergency_app_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('api-base-url').value = settings.api_base_url || 'http://localhost:8000';
                document.getElementById('api-timeout').value = settings.api_timeout || 30;
                document.getElementById('emergency-contact').value = settings.emergency_contact || '+1234567890';
                document.getElementById('search-radius').value = settings.search_radius || 10;
            }
            
            checkApiHealth();
            setInterval(checkApiHealth, 30000);
        });
    </script>
</body>
</html>
